<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台首页</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="__CSS__/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="__CSS__/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="__CSS__/animate.min.css" rel="stylesheet">
    <link href="__CSS__/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="__CSS__/style.min.css?v=4.1.0" rel="stylesheet">
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated bounceIn">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>A Gift For Kristin</h5>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h4>房间统计</h4>
                </div>
                <div class="ibox-content">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>房间</th>
                                <th>总订单数</th>
                                <th>总出租天数</th>
                                <th>总订单金额</th>
                                <th>总利润</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="room_statistics" id="room_statistic"}
                                <tr>
                                    <td>{$room_statistic.name}</td>
                                    <td><span class="label label-warning">{$room_statistic.num}</span></td>
                                    <td>{$room_statistic.days}</td>
                                    <td>{$room_statistic.total_price}</td>
                                    <td><span class="label label-danger">{$room_statistic.profit_price}</span></td>
                                </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h4>平台统计</h4>
                </div>
                <div class="ibox-content">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>平台</th>
                                <th>总订单数</th>
                                <th>总出租天数</th>
                                <th>总订单金额</th>
                                <th>总利润</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="platform_statistics" id="platform_statistic"}
                                <tr>
                                    <td>{$platform_statistic.name}</td>
                                    <td><span class="label label-warning">{$platform_statistic.num}</span></td>
                                    <td>{$platform_statistic.days}</td>
                                    <td>{$platform_statistic.total_price}</td>
                                    <td><span class="label label-danger">{$platform_statistic.profit_price}</span></td>
                                </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- 月度利润-->
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <div class="input-group date month-profit-date">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input type="text" class="form-control month-profit-date-input" value="{$y_m_str}" readonly="readonly">
                    </div>
                </div>
                <div class="ibox-content">
                    <table class="table table-hover" id="month-profit-table">
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h4>今日房间</h4>
                </div>
                <div class="ibox-content">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>房间</th>
                                <th>客人退房</th>
                                <th>客人入住</th>
                                <th>客人居住中...</th>
                                <th>需要打扫</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="rooms_status_today" id="room_status_today"}
                                <tr>
                                    <td>{$room_status_today.name}</td>
                                    <td>
                                        {if condition="$room_status_today.e_order"}
                                            <span class="label label-primary">是</span>
                                            <a href="{:url('order/detail')}?id={$room_status_today.e_order.id}">
                                                <span class="label label-info">查看订单 <i class="fa fa-arrow-right"></i></span>
                                            </a>
                                        {else /}否
                                        {/if}
                                    </td>
                                    <td>
                                        {if condition="$room_status_today.b_order"}
                                            <span class="label label-primary">是</span>
                                            <a href="{:url('order/detail')}?id={$room_status_today.b_order.id}">
                                                <span class="label label-info">查看订单 <i class="fa fa-arrow-right"></i></span>
                                            </a>
                                        {else /}否
                                        {/if}
                                    </td>
                                    <td>
                                        {if condition="$room_status_today.c_order"}
                                            <span class="label label-primary">是</span>
                                            <a href="{:url('order/detail')}?id={$room_status_today.c_order.id}">
                                                <span class="label label-info">查看订单 <i class="fa fa-arrow-right"></i></span>
                                            </a>
                                        {/if}
                                    </td>
                                    <td>
                                        {if condition="$room_status_today.e_order"}
                                            <span class="label label-danger">是</span>
                                        {else /}否
                                        {/if}
                                    </td>
                                </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h4>明日房间</h4>
                </div>
                <div class="ibox-content">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>房间</th>
                                <th>客人退房</th>
                                <th>客人入住</th>
                                <th>客人居住中...</th>
                                <th>需要打扫</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="rooms_status_yesterday" id="room_status_yesterday"}
                                <tr>
                                    <td>{$room_status_yesterday.name}</td>
                                    <td>
                                        {if condition="$room_status_yesterday.e_order"}
                                            <span class="label label-primary">是</span>
                                            <a href="{:url('order/detail')}?id={$room_status_yesterday.e_order.id}">
                                                <span class="label label-info">查看订单 <i class="fa fa-arrow-right"></i></span>
                                            </a>
                                        {else /}否
                                        {/if}
                                    </td>
                                    <td>
                                        {if condition="$room_status_yesterday.b_order"}
                                            <span class="label label-primary">是</span>
                                            <a href="{:url('order/detail')}?id={$room_status_yesterday.b_order.id}">
                                                <span class="label label-info">查看订单 <i class="fa fa-arrow-right"></i></span>
                                            </a>
                                        {else /}否
                                        {/if}
                                    </td>
                                    <td>
                                        {if condition="$room_status_yesterday.c_order"}
                                            <span class="label label-primary">是</span>
                                            <a href="{:url('order/detail')}?id={$room_status_yesterday.c_order.id}">
                                                <span class="label label-info">查看订单 <i class="fa fa-arrow-right"></i></span>
                                            </a>
                                        {/if}
                                    </td>
                                    <td>
                                        {if condition="$room_status_yesterday.e_order"}
                                            <span class="label label-danger">是</span>
                                        {else /}否
                                        {/if}
                                    </td>
                                </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="__JS__/jquery.min.js?v=2.1.4"></script>
<script src="__JS__/bootstrap.min.js?v=3.3.6"></script>
<script src="__JS__/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="__JS__/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="__JS__/plugins/layer/layer.min.js"></script>
<script src="__JS__/hplus.min.js?v=4.1.0"></script>
<script src="__JS__/plugins/datapicker/bootstrap-datepicker.js"></script>
<!--<script type="text/javascript" src="__JS__/contabs.min.js"></script>-->
<script type="text/javascript" src="__JS__/contabs.js"></script>
<script src="__JS__/plugins/pace/pace.min.js"></script>
<script type="text/javascript">
    // 月份-订单-柱状图日期选择动作
    $('.month-profit-date').each(function(i, e){
        $(this).datepicker({
            minViewMode: 1,
            keyboardNavigation: false,
            forceParse: false,
            autoclose: true,
            todayHighlight: true,
            format:"yyyy-mm"
        }).on('changeDate', function(){
            var month = $(this).children('.month-profit-date-input').val().substr(5) - 0;
            changeMonthForProfit(month)
        });
    });

    //初始化为当前月利润
    changeMonthForProfit({$m_str});
    //更改月份获取利润动作
    function changeMonthForProfit(month){
        var url = "{:url('index/ajax_getMonthProfit')}";
        var data = {
            "month": month
        }
        $.post(url, data, function(res){
            var html = createMonthForProfit(res);
            $('#month-profit-table').empty().append(html);
        })
    }

    //获取月份利润填充数据
    function createMonthForProfit(data){
        var rooms = data['rooms'];
        var platforms = data['platforms'];
        var total = data['total'];
        var total_rent = data['total_rent'];
        var html = '';
        html += `<thead><tr><th>月度利润</th>`;
        for(var i = 0; i < rooms[0].profits.length; i++){
            var profit = rooms[0].profits[i];
            html += `<th>` + profit['platform_name'] + `</th>`;
        }
        html += `<th>房间总计</th><th>去掉房租</th></tr></thead>`;
        html += `<tbody>`;
        for(var i = 0; i < rooms.length; i++){
            var room_profit = rooms[i];
            html += `<tr><td>` + room_profit['name'] + `</td>`;
            for(var j = 0; j < room_profit.profits.length; j++){
                var profit = room_profit.profits[j];
                html += `<td>` + profit['profit'] + '</td>';
            }
            html += `<td><span class="label label-warning">` + room_profit['total'] + `</span></td>`;
            html += `<td><span class="label label-info">` + room_profit['total_rent'] + `</span></td></tr>`;
        }
        html += `<tr><td>平台总计</td>`;
        for(var i = 0; i < platforms.length; i++){
            html += `<td><span class="label label-warning">` + platforms[i]['profit'] + `</span></td>`;
        }
        html += `<td><span class="label label-danger">` + total + `</span></td>`;
        html += `<td><span class="label label-primary">` + total_rent + `</span></td></tr>`;
        html += `</tbody>`;
        return html;
    }
</script>
</body>
</html>
